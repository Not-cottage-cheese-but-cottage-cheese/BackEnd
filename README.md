## Back End

Подготовка окружения к запуску:

```bash
# Для зауска необходим Python 3.10
# с установленными зависимотями из requirements.tx

pip install -r requirements.txt


# Для первичного создания базы данных необходимо выполнить скрипт:

python db.py
```

Для выполнения команд, подразумевающих использование VK api, необходимо создать `.env` файл в корне проекта с access токеном пользователя:

```env
# .env
ACCESS_TOKEN=830792YOURACCESSTOKEN...
```

Помимо использования консольных команд, можно использовать API. Запуск осуществляется следующей командой:

```bash
python api.py
```

Автоматически сгенерированная документация с возможностью вызова методов будет доступна по адресу: `localhost:4000/docs`

---

### 10

#### Задание

Загрузите все мемы в вашу базу (или просто скачайте их локально, используя API ВКонтакте). Выведите в консоль информацию о полученных мемах — их авторов и количество лайков.

#### Решение

Загрузить изображения из альбома можно используя эндпоинт `/api/download_images` (см. автодокументацию) или при помощи команды (требуется access токен в `.env` файле):

```bash
python download_images.py
# или
python download_images.py --owner-id -197700721 --album-id 281940823
```

Просмотреть список всех загруженных картинок можно при помощи эндпоинта `/api/print_images` или команды:

```bash
python print_images.py
```

---

### 20

#### Задание

Поддержите две команды — лайк и скип каждого из предложенных мемов. Показывайте мемы в порядке их появления в альбоме.

#### Решение

##### Консольная утилита

Для просмотра и оценки изображений необходимо запустить утилиту командой:

```bash
python explore_images.py
# или
python explore_images.py --album-id 281940823
```

Пользователю будет показано изображение (ссылка на просмотр) и немного информации о нем (имя автора и количество лайков), а также будут предложены варианты действий:

- like - лайкает изображение и переходит к следующему
- skip - переходит к следующему изображению
- quit - выходит из утилиты

Пример работы:

```
Как вам данная картинка?
Ссылка: https://sun9-22.userapi.com/s/v1/ig2/kXarI0MzcoVWDPui1zyH0aDakwoFToFU3nBQPlTnkAxmyy3MpCBi0Kp49d5iq48aI9MlFlKoj3S6H5typmUJhsRZ.jpg?size=1920x1080&quality=95&type=album
Автор: Администрация ВКонтакте
Число лайков: 10
Вы решаете: (like, skip, quit) [skip]: like

А вот эта?
Ссылка: https://sun9-61.userapi.com/s/v1/ig2/qHFoG7wwJEbNnCguxTo6S4LWcH0evp56YrITqH_oV013qIA1UjVScgZ0G3q49cRv5jZXcBJ6AekdLoV5sZyyQPcS.jpg?size=1528x2160&quality=95&type=album
Автор: Влад Хейнов
Число лайков: 5
Вы решаете: (like, skip, quit) [skip]: skip

Вы просмотрели все изображения в альбоме, хотите продолжить? [Y/n]: n

Спасибо за участие!
```

##### API

Так как данное задание не подразумевает написание полноценного клиента, будет предложено несколько эндпоинтов, используя которые его можно было бы реализовать. Поиграться с ними можно все также в автодокументации.

Эндпоинт `/api/get_first_image_in_album` возвращает первое изображение из альбома. Имеет опциональный параметр album_id - ID альбома с изображениями (по умолчанию наш альбом с мемами).

Эндпоинт `/api/like_image` увеличивает счетчик лайков изображения на один и возвращает следующее изображение в альбоме (циклически). Имеет обязательный параметр id - ID изображения.

Эндпоинт `/api/skip_image` возвращает следующее изображение в альбоме (циклически). Имеет обязательный параметр id - ID изображения.

**ВНИМАНИЕ:** ID следующего изображения это поле `id`, а не `image_id` в ответах на предыдущие два эндпоинта.

---

### 30

#### Задание

Отрегулируйте порядок выдачи мемов таким образом, чтобы заданный заранее мем набрал больше всего лайков. Показывайте его чаще других, а конкурирующие мемы, набирающие много лайков, показывайте реже.

#### Решение

Так как в следующем задании (на 40 баллов) нужно будет дополнить базу новыми изображениями, было решено отказаться от логики просмотра картинок только в одном альбоме, теперь отображаются все доступные изображения из базы.

##### Принцип работы

Каждому изображению присваивается вес равный числу лайков плюс один: `w[i] = likes_count[i] + 1`. Исключением является только изображение "фаворит", его вес равен сумме весов остальных изображений: `w[F] = sum([w[i] for i in range(N) where i != F])`. Чем больше вес, тем больше веротность вытащить изображение. Вероятность вытащить изобращение считается следующим образом: `p[i] = w[i] / sum([w[j] for i in range(N)])`. Таким образом с наибольшей верояностью мы достаем "фаворит" (вероятность ~0.5), остальные верояности пропорциональны числу лайков.

Чтобы избежать получения одного и того же изображения два раза подряд, ранее полученное изображение исключается во второй итерации (Из-за этого вероятность получить "фаворита" становится незначительно меньше).

##### Консольная утилита

Для просмотра и оценки изображений необходимо запустить утилиту командой:

```bash
python explore_images_v2.py
```

Утилита сначала спрашивает ID изображения "фаворита", а дальше работа с ней не отличается от работы с утилитой из задания на 20 баллов.

##### API

Эндпоинт `/api/like_image_v2` увеличивает счетчик лайков изображения на один и возвращает следующее случайное изображение. Имеет обязательный параметр id - ID изображения (возвращается изображение, отличного от переданного), и обязательный параметр favourite_id - ID изображения "фаворита" (если задан ID, которого нет в базе, то он не учитывается).

Эндпоинт `/api/skip_image_v2` возвращает следующее случайное изображение. Имеет необязательный параметр id - ID изображения (возвращается изображение, отличного от переданного; по умолчанию -1 - возвращает случайное изображение), и обязательный параметр favourite_id - ID изображения "фаворита" (если задан ID, которого нет в базе, то он не учитывается).

**ВНИМАНИЕ:** ID следующего изображения это поле `id`, а не `image_id` в ответах на предыдущие два эндпоинта.

---

### 40

#### Задание

Пополните коллекцию ваших мемов каким-нибудь большим мемным сообществом!

#### Решение

База изображений была пополнена следующими альбомами:

- [еврейские анекдоты и мопсы: Ваши мопсики](https://vk.com/album-201685685_276590697)
- [Типичный программист: Забавные кадры из фильмов и сериалов](https://vk.com/album-30666517_179046344)
- [Типичный программист: Цитаты](https://vk.com/album-30666517_182535992)

При помощи соответствующих команд:

```bash
# Ваши мопсики
python download_images.py --owner-id -201685685 --album-id 276590697
# Забавные кадры из фильмов и сериалов
python download_images.py --owner-id -30666517 --album-id 179046344
# Цитаты
python download_images.py --owner-id -30666517 --album-id 182535992
```
